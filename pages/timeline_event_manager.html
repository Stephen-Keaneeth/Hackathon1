<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timeline Event Manager - Digital Guidance Platform</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <script src="../js/database.js"></script>
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fdigitalgu1196back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-background min-h-screen">
    <!-- Navigation Header -->
    <nav class="bg-surface shadow-elevation-2 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-8 w-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h1 class="text-xl font-semibold text-text-primary">CareerGuide</h1>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="home_dashboard.html" class="text-text-secondary hover:text-text-primary px-3 py-2 rounded-md text-sm font-medium transition-smooth">Home</a>
                        <a href="user_profile_management.html" class="text-text-secondary hover:text-text-primary px-3 py-2 rounded-md text-sm font-medium transition-smooth">Profile</a>
                        <a href="aptitude_assessment_quiz.html" class="text-text-secondary hover:text-text-primary px-3 py-2 rounded-md text-sm font-medium transition-smooth">Quiz</a>
                        <a href="course_career_mapping.html" class="text-text-secondary hover:text-text-primary px-3 py-2 rounded-md text-sm font-medium transition-smooth">Careers</a>
                        <a href="college_discovery.html" class="text-text-secondary hover:text-text-primary px-3 py-2 rounded-md text-sm font-medium transition-smooth">Colleges</a>
                        <a href="timeline_event_manager.html" class="bg-primary-100 text-primary px-3 py-2 rounded-md text-sm font-medium">Timeline</a>
                    </div>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-text-secondary hover:text-text-primary p-2">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-surface border-t border-border">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="home_dashboard.html" class="text-text-secondary hover:text-text-primary block px-3 py-2 rounded-md text-base font-medium">Home</a>
                <a href="user_profile_management.html" class="text-text-secondary hover:text-text-primary block px-3 py-2 rounded-md text-base font-medium">Profile</a>
                <a href="aptitude_assessment_quiz.html" class="text-text-secondary hover:text-text-primary block px-3 py-2 rounded-md text-base font-medium">Quiz</a>
                <a href="course_career_mapping.html" class="text-text-secondary hover:text-text-primary block px-3 py-2 rounded-md text-base font-medium">Careers</a>
                <a href="college_discovery.html" class="text-text-secondary hover:text-text-primary block px-3 py-2 rounded-md text-base font-medium">Colleges</a>
                <a href="timeline_event_manager.html" class="bg-primary-100 text-primary block px-3 py-2 rounded-md text-base font-medium">Timeline</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header Section -->
        <section class="mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-semibold text-text-primary mb-2">Timeline Event Manager</h2>
                    <p class="text-text-secondary">Track important educational milestones, deadlines, and opportunities</p>
                </div>
                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="backup-timeline" class="btn-outline text-sm px-4 py-2">
                        <i class="fas fa-download mr-2"></i>Backup Timeline
                    </button>
                    <button id="restore-timeline" class="btn-outline text-sm px-4 py-2">
                        <i class="fas fa-upload mr-2"></i>Restore Timeline
                    </button>
                    <button id="add-event-btn" class="btn-primary text-sm px-4 py-2">
                        <i class="fas fa-plus mr-2"></i>Add Event
                    </button>
                </div>
            </div>
        </section>

        <!-- Filter Controls -->
        <section class="mb-6">
            <div class="card">
                <div class="flex flex-col md:flex-row md:items-center gap-4">
                    <div class="flex items-center gap-4">
                        <label class="text-sm font-medium text-text-primary">Filter by:</label>
                        <div class="flex items-center gap-2">
                            <button id="filter-upcoming" class="filter-btn active bg-primary-100 text-primary px-3 py-1 rounded-full text-sm font-medium transition-smooth">
                                Upcoming
                            </button>
                            <button id="filter-past" class="filter-btn text-text-secondary hover:text-text-primary px-3 py-1 rounded-full text-sm font-medium transition-smooth">
                                Past Events
                            </button>
                            <button id="filter-all" class="filter-btn text-text-secondary hover:text-text-primary px-3 py-1 rounded-full text-sm font-medium transition-smooth">
                                All Events
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <label class="text-sm font-medium text-text-primary">Type:</label>
                        <select id="event-type-filter" class="input-field text-sm py-2 px-3 w-auto min-w-32">
                            <option value="all">All Types</option>
                            <option value="admission">Admission</option>
                            <option value="scholarship">Scholarship</option>
                            <option value="exam">Exam</option>
                            <option value="application">Application</option>
                            <option value="interview">Interview</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- Timeline Container -->
        <section class="mb-8">
            <div id="timeline-container" class="relative">
                <!-- Timeline Line (Desktop) -->
                <div class="hidden md:block absolute left-8 top-0 bottom-0 w-0.5 bg-border"></div>
                
                <!-- Timeline Events -->
                <div id="timeline-events" class="space-y-6">
                    <!-- Events will be dynamically inserted here -->
                </div>

                <!-- Empty State -->
                <div id="empty-timeline" class="hidden text-center py-12">
                    <div class="bg-primary-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-calendar-plus text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-text-primary mb-2">No Events Found</h3>
                    <p class="text-text-secondary mb-4">Start organizing your educational journey by adding important dates and deadlines.</p>
                    <button class="btn-primary" onclick="document.getElementById('add-event-btn').click()">
                        <i class="fas fa-plus mr-2"></i>Add Your First Event
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Add/Edit Event Modal -->
    <div id="event-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-surface rounded-xl shadow-elevation-4 w-full max-w-md max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 id="modal-title" class="text-xl font-semibold text-text-primary">Add New Event</h3>
                    <button id="close-modal" class="text-text-secondary hover:text-text-primary p-1">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="event-form" class="space-y-4">
                    <div>
                        <label for="event-title" class="block text-sm font-medium text-text-primary mb-2">Event Title *</label>
                        <input type="text" id="event-title" name="title" required class="input-field" placeholder="e.g., JEE Main Application Deadline" />
                    </div>

                    <div>
                        <label for="event-type" class="block text-sm font-medium text-text-primary mb-2">Event Type *</label>
                        <select id="event-type" name="type" required class="input-field">
                            <option value>Select event type</option>
                            <option value="admission">Admission</option>
                            <option value="scholarship">Scholarship</option>
                            <option value="exam">Exam</option>
                            <option value="application">Application</option>
                            <option value="interview">Interview</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div>
                        <label for="event-date" class="block text-sm font-medium text-text-primary mb-2">Date *</label>
                        <input type="date" id="event-date" name="date" required class="input-field" />
                    </div>

                    <div>
                        <label for="event-time" class="block text-sm font-medium text-text-primary mb-2">Time (Optional)</label>
                        <input type="time" id="event-time" name="time" class="input-field" />
                    </div>

                    <div>
                        <label for="event-description" class="block text-sm font-medium text-text-primary mb-2">Description</label>
                        <textarea id="event-description" name="description" rows="3" class="input-field resize-none" placeholder="Additional details about this event..."></textarea>
                    </div>

                    <div>
                        <label for="event-reminder" class="block text-sm font-medium text-text-primary mb-2">Reminder</label>
                        <select id="event-reminder" name="reminder" class="input-field">
                            <option value="0">No reminder</option>
                            <option value="1">1 day before</option>
                            <option value="3">3 days before</option>
                            <option value="7">1 week before</option>
                            <option value="14">2 weeks before</option>
                        </select>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button type="button" id="cancel-event" class="btn-outline flex-1">Cancel</button>
                        <button type="submit" id="save-event" class="btn-primary flex-1">
                            <span id="save-text">Save Event</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-surface rounded-xl shadow-elevation-4 w-full max-w-sm">
            <div class="p-6">
                <div class="text-center">
                    <div class="bg-accent-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-trash text-accent text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-text-primary mb-2">Delete Event</h3>
                    <p class="text-text-secondary mb-6">Are you sure you want to delete this event? This action cannot be undone.</p>
                    <div class="flex gap-3">
                        <button id="cancel-delete" class="btn-outline flex-1">Cancel</button>
                        <button id="confirm-delete" class="bg-accent hover:bg-accent-700 text-white px-6 py-3 rounded-md font-medium transition-smooth flex-1">
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden File Input for Restore -->
    <input type="file" id="restore-file-input" accept=".json" class="hidden" />

    <script>
        // Timeline Event Manager Implementation
        class TimelineEventManager {
            constructor() {
                this.events = this.loadEvents();
                this.currentFilter = 'upcoming';
                this.currentTypeFilter = 'all';
                this.editingEventId = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.renderTimeline();
                this.updateFilterButtons();
            }

            setupEventListeners() {
                // Mobile menu toggle
                document.getElementById('mobile-menu-button').addEventListener('click', () => {
                    const mobileMenu = document.getElementById('mobile-menu');
                    mobileMenu.classList.toggle('hidden');
                });

                // Modal controls
                document.getElementById('add-event-btn').addEventListener('click', () => this.openModal());
                document.getElementById('close-modal').addEventListener('click', () => this.closeModal());
                document.getElementById('cancel-event').addEventListener('click', () => this.closeModal());

                // Form submission
                document.getElementById('event-form').addEventListener('submit', (e) => this.handleFormSubmit(e));

                // Filter controls
                document.getElementById('filter-upcoming').addEventListener('click', () => this.setFilter('upcoming'));
                document.getElementById('filter-past').addEventListener('click', () => this.setFilter('past'));
                document.getElementById('filter-all').addEventListener('click', () => this.setFilter('all'));
                document.getElementById('event-type-filter').addEventListener('change', (e) => this.setTypeFilter(e.target.value));

                // Backup/Restore
                document.getElementById('backup-timeline').addEventListener('click', () => this.backupTimeline());
                document.getElementById('restore-timeline').addEventListener('click', () => this.restoreTimeline());
                document.getElementById('restore-file-input').addEventListener('change', (e) => this.handleFileRestore(e));

                // Delete modal
                document.getElementById('cancel-delete').addEventListener('click', () => this.closeDeleteModal());
                document.getElementById('confirm-delete').addEventListener('click', () => this.confirmDelete());

                // Close modals on outside click
                document.getElementById('event-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'event-modal') this.closeModal();
                });
                document.getElementById('delete-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'delete-modal') this.closeDeleteModal();
                });
            }

            loadEvents() {
                let events;
                
                if (window.dbManager) {
                    events = window.dbManager.getData('timelineEvents');
                    if (events && Array.isArray(events)) {
                        return events;
                
                // Sample events for demonstration
                return [
                    {
                        id: 'evt_1',
                        title: 'JEE Main Application Deadline',
                        type: 'application',
                        date: '2025-09-18',
                        time: '',
                        description: 'Last date to apply for JEE Main 2026',
                        reminder: 3,
                        created: new Date().toISOString()
                    },
                    {
                        id: 'evt_2',
                        title: 'College Fair - Delhi',
                        type: 'other',
                        date: '2025-10-15',
                        time: '10:00',
                        description: 'Annual college fair with 100+ participating institutions',
                        reminder: 7,
                        created: new Date().toISOString()
                    },
                    {
                        id: 'evt_3',
                        title: 'Merit Scholarship Application',
                        type: 'scholarship',
                        date: '2025-11-01',
                        time: '',
                        description: 'State government merit scholarship for undergraduate students',
                        reminder: 14,
                        created: new Date().toISOString()
                    },
                    {
                        id: 'evt_4',
                        title: 'NEET Exam',
                        type: 'exam',
                        date: '2025-05-05',
                        time: '14:00',
                        description: 'National Eligibility cum Entrance Test for medical courses',
                        reminder: 7,
                        created: new Date().toISOString()
                    }
                ];
            }

            saveEvents() {
                if (window.dbManager) {
                    const success = window.dbManager.saveData('timelineEvents', this.events);
                    if (!success) {
                        alert('Error saving events. Please try again.');
                    }
                } else {
                    try {
                        localStorage.setItem('timelineEvents', JSON.stringify(this.events));
                    } catch (e) {
                        console.error('Error saving timeline events:', e);
                        alert('Error saving events. Please try again.');
                    }
                const modal = document.getElementById('event-modal');
                const title = document.getElementById('modal-title');
                const saveText = document.getElementById('save-text');
                
                if (eventId) {
                    const event = this.events.find(e => e.id === eventId);
                    title.textContent = 'Edit Event';
                    saveText.textContent = 'Update Event';
                    this.populateForm(event);
                } else {
                } else {
                    try {
                        const stored = localStorage.getItem('timelineEvents');
                        if (stored) {
                            events = JSON.parse(stored);
                            if (Array.isArray(events)) {
                                return events;
                            }
                        }
                    } catch (e) {
                        console.warn('Error parsing timeline events:', e);
                        localStorage.removeItem('timelineEvents'); // Clear corrupted data
                    }
                }
                
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            closeModal() {
                document.getElementById('event-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
                this.editingEventId = null;
                this.resetForm();
            }

            populateForm(event) {
                document.getElementById('event-title').value = event.title;
                document.getElementById('event-type').value = event.type;
                document.getElementById('event-date').value = event.date;
                document.getElementById('event-time').value = event.time || '';
                document.getElementById('event-description').value = event.description || '';
                document.getElementById('event-reminder').value = event.reminder || '0';
            }

            resetForm() {
                document.getElementById('event-form').reset();
            }

            handleFormSubmit(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const eventData = {
                    title: formData.get('title').trim(),
                    type: formData.get('type'),
                    date: formData.get('date'),
                    time: formData.get('time') || '',
                    description: formData.get('description').trim(),
                    reminder: parseInt(formData.get('reminder')) || 0
                };

                if (this.editingEventId) {
                    this.updateEvent(this.editingEventId, eventData);
                } else {
                    this.addEvent(eventData);
                }

                this.closeModal();
            }

            addEvent(eventData) {
                const event = {
                    id: 'evt_' + Date.now(),
                    ...eventData,
                    created: new Date().toISOString()
                };
                
                this.events.push(event);
                this.saveEvents();
                this.renderTimeline();
            }

            updateEvent(eventId, eventData) {
                const index = this.events.findIndex(e => e.id === eventId);
                if (index !== -1) {
                    this.events[index] = {
                        ...this.events[index],
                        ...eventData,
                        updated: new Date().toISOString()
                    };
                    this.saveEvents();
                    this.renderTimeline();
                }
            }

            deleteEvent(eventId) {
                this.eventToDelete = eventId;
                document.getElementById('delete-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            confirmDelete() {
                if (this.eventToDelete) {
                    this.events = this.events.filter(e => e.id !== this.eventToDelete);
                    this.saveEvents();
                    this.renderTimeline();
                    this.eventToDelete = null;
                }
                this.closeDeleteModal();
            }

            closeDeleteModal() {
                document.getElementById('delete-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
                this.eventToDelete = null;
            }

            setFilter(filter) {
                this.currentFilter = filter;
                this.updateFilterButtons();
                this.renderTimeline();
            }

            setTypeFilter(typeFilter) {
                this.currentTypeFilter = typeFilter;
                this.renderTimeline();
            }

            updateFilterButtons() {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active', 'bg-primary-100', 'text-primary');
                    btn.classList.add('text-text-secondary');
                });

                const activeBtn = document.getElementById(`filter-${this.currentFilter}`);
                if (activeBtn) {
                    activeBtn.classList.add('active', 'bg-primary-100', 'text-primary');
                    activeBtn.classList.remove('text-text-secondary');
                }
            }

            getFilteredEvents() {
                const now = new Date();
                now.setHours(0, 0, 0, 0);

                let filtered = this.events.filter(event => {
                    const eventDate = new Date(event.date);
                    eventDate.setHours(0, 0, 0, 0);

                    // Date filter
                    if (this.currentFilter === 'upcoming' && eventDate < now) return false;
                    if (this.currentFilter === 'past' && eventDate >= now) return false;

                    // Type filter
                    if (this.currentTypeFilter !== 'all' && event.type !== this.currentTypeFilter) return false;

                    return true;
                });

                // Sort by date
                return filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
            }

            renderTimeline() {
                const container = document.getElementById('timeline-events');
                const emptyState = document.getElementById('empty-timeline');
                const filteredEvents = this.getFilteredEvents();

                if (filteredEvents.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                container.innerHTML = filteredEvents.map(event => this.renderEventCard(event)).join('');
            }

            renderEventCard(event) {
                const eventDate = new Date(event.date);
                const now = new Date();
                const daysDiff = Math.ceil((eventDate - now) / (1000 * 60 * 60 * 24));
                const isUrgent = daysDiff <= 14 && daysDiff >= 0;
                const isPast = eventDate < now;

                const typeIcons = {
                    admission: 'fas fa-graduation-cap',
                    scholarship: 'fas fa-award',
                    exam: 'fas fa-file-alt',
                    application: 'fas fa-paper-plane',
                    interview: 'fas fa-users',
                    other: 'fas fa-calendar'
                };

                const typeColors = {
                    admission: 'primary',
                    scholarship: 'secondary',
                    exam: 'accent',
                    application: 'warning',
                    interview: 'primary',
                    other: 'text-secondary'
                };

                const urgentClass = isUrgent ? 'border-l-4 border-accent bg-accent-50' : '';
                const pastClass = isPast ? 'opacity-60' : '';

                return `
                    <div class="relative flex items-start gap-4 md:gap-6 ${urgentClass} ${pastClass}">
                        <!-- Timeline Dot (Desktop) -->
                        <div class="hidden md:flex flex-shrink-0 w-16 h-16 bg-${typeColors[event.type]}-100 rounded-full items-center justify-center relative z-10">
                            <i class="${typeIcons[event.type]} text-${typeColors[event.type]} text-xl"></i>
                        </div>

                        <!-- Event Card -->
                        <div class="card flex-1 hover:shadow-elevation-3 transition-smooth">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-start gap-3">
                                    <!-- Mobile Icon -->
                                    <div class="md:hidden flex-shrink-0 w-10 h-10 bg-${typeColors[event.type]}-100 rounded-lg flex items-center justify-center">
                                        <i class="${typeIcons[event.type]} text-${typeColors[event.type]}"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-text-primary mb-1">${event.title}</h3>
                                        <div class="flex items-center gap-4 text-sm text-text-secondary mb-2">
                                            <span class="flex items-center gap-1">
                                                <i class="fas fa-calendar text-xs"></i>
                                                ${this.formatDate(event.date)}
                                            </span>
                                            ${event.time ? `
                                                <span class="flex items-center gap-1">
                                                    <i class="fas fa-clock text-xs"></i>
                                                    ${this.formatTime(event.time)}
                                                </span>
                                            ` : ''}
                                        </div>
                                        ${event.description ? `
                                            <p class="text-sm text-text-secondary">${event.description}</p>
                                        ` : ''}
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    ${isUrgent ? `
                                        <span class="bg-accent text-white text-xs px-2 py-1 rounded-full">
                                            ${daysDiff === 0 ? 'Today' : `${daysDiff} days`}
                                        </span>
                                    ` : ''}
                                    <div class="flex items-center gap-1">
                                        <button onclick="timelineManager.openModal('${event.id}')" 
                                                class="text-text-secondary hover:text-primary p-1 transition-smooth">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="timelineManager.deleteEvent('${event.id}')" 
                                                class="text-text-secondary hover:text-accent p-1 transition-smooth">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="bg-${typeColors[event.type]}-100 text-${typeColors[event.type]} text-xs px-2 py-1 rounded-full capitalize">
                                    ${event.type}
                                </span>
                                ${event.reminder > 0 ? `
                                    <span class="text-xs text-text-secondary flex items-center gap-1">
                                        <i class="fas fa-bell"></i>
                                        ${event.reminder} day${event.reminder > 1 ? 's' : ''} before
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
            }

            formatTime(timeString) {
                if (!timeString) return '';
                const [hours, minutes] = timeString.split(':');
                const date = new Date();
                date.setHours(parseInt(hours), parseInt(minutes));
                return date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            }

            backupTimeline() {
                const data = {
                    events: this.events,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `timeline-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            restoreTimeline() {
                document.getElementById('restore-file-input').click();
            }

            handleFileRestore(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.events && Array.isArray(data.events)) {
                            this.events = data.events;
                            this.saveEvents();
                            this.renderTimeline();
                            alert('Timeline restored successfully!');
                        } else {
                            alert('Invalid backup file format.');
                        }
                    } catch (error) {
                        alert('Error reading backup file.');
                    }
                };
                reader.readAsText(file);
                
                // Reset file input
                event.target.value = '';
            }
        }

        // Initialize Timeline Manager
        let timelineManager;
        document.addEventListener('DOMContentLoaded', () => {
            timelineManager = new TimelineEventManager();
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>